<%# app/views/ledger_transactions/new.html.erb %>

<%# Adicionamos alguns estilos simples para melhorar a aparência %>
<style>
  .form-container { max-width: 600px; margin: 0 auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
  .form-group { margin-bottom: 15px; }
  .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
  .form-group input, .form-group textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
  .form-group pre { background-color: #f0f0f0; padding: 10px; border-radius: 4px; white-space: pre-wrap; word-break: break-all; }
  .form-actions input { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; }
  .error-messages { color: red; background-color: #fdd; border: 1px solid #fbb; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
</style>

<div class="form-container">
  <h1>Criar Nova Transação</h1>

  <%# O form_with usa o @ledger_transaction do controller para montar o formulário.
      Ele é inteligente e sabe que, por ser um novo objeto, deve enviar os dados via POST
      para a rota /ledger_transactions. %>
  <%= form_with model: @ledger_transaction do |form| %>

    <%# Bloco para exibir erros de validação, caso existam. %>
    <% if form.object.errors.any? %>
      <div class="error-messages">
        <h2><%= pluralize(form.object.errors.count, "erro") %> impediu esta transação de ser salva:</h2>
        <ul>
          <% form.object.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-group">
      <strong>De (Sua Carteira):</strong>
      <%# Apenas exibimos a chave pública (endereço) do usuário para confirmação. %>
      <pre><%= @sender_address %></pre>
      <%# O valor real é enviado através de um campo oculto para segurança. %>
      <%= form.hidden_field :sender, value: @sender_address %>
    </div>

    <div class="form-group">
      <%= form.label :recipient, "Para (Endereço da Carteira do Destinatário):" %>
      <%# Usamos uma 'text_area' para facilitar colar chaves públicas longas. %>
      <%= form.text_area :recipient, rows: 6, placeholder: "Cole a chave pública do destinatário aqui..." %>
    </div>

    <div class="form-group">
      <%= form.label :amount, "Quantia:" %>
      <%= form.number_field :amount, step: 0.01, placeholder: "ex: 50.75" %>
    </div>

    <div class="form-actions">
      <%= form.submit "Assinar e Enviar Transação" %>
    </div>
  <% end %>

  <br>
  <%= link_to 'Voltar para a Blockchain', root_path %>
</div>